<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf GPS</title>
    <!-- Tailwind CSS for modern, mobile-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full mx-auto">
        <!-- App Title and Course Info -->
        <div class="text-center mb-6">
            <h1 id="course-name" class="text-3xl font-extrabold text-gray-900 mb-2"></h1>
            <p id="hole-info" class="text-lg text-gray-500 font-medium"></p>
        </div>

        <!-- Distance Display -->
        <div class="grid grid-cols-3 gap-4 text-center mb-6">
            <!-- Front of Green -->
            <div class="bg-green-100 rounded-2xl p-4 shadow-inner">
                <p class="text-sm font-semibold text-gray-600">Front</p>
                <p id="distance-front" class="text-4xl font-black text-green-700 mt-2">--</p>
                <p class="text-xs text-gray-400">yards</p>
            </div>
            <!-- Center of Green -->
            <div class="bg-green-100 rounded-2xl p-4 shadow-inner">
                <p class="text-sm font-semibold text-gray-600">Center</p>
                <p id="distance-center" class="text-4xl font-black text-green-700 mt-2">--</p>
                <p class="text-xs text-gray-400">yards</p>
            </div>
            <!-- Back of Green -->
            <div class="bg-green-100 rounded-2xl p-4 shadow-inner">
                <p class="text-sm font-semibold text-gray-600">Back</p>
                <p id="distance-back" class="text-4xl font-black text-green-700 mt-2">--</p>
                <p class="text-xs text-gray-400">yards</p>
            </div>
        </div>
        
        <!-- Loading and Error Messages -->
        <p id="message-area" class="text-center text-sm font-medium h-6 text-gray-600"></p>

        <!-- Navigation and Actions -->
        <div class="flex items-center justify-between gap-4 mt-6">
            <button id="prev-hole-btn" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-full shadow-md hover:bg-gray-300 transition-colors">
                Previous
            </button>
            <button id="get-distance-btn" class="flex-1 bg-green-600 text-white font-bold py-3 px-4 rounded-full shadow-lg hover:bg-green-700 transition-colors transform hover:scale-105">
                Refresh
            </button>
            <button id="next-hole-btn" class="flex-1 bg-gray-200 text-gray-700 font-bold py-3 px-4 rounded-full shadow-md hover:bg-gray-300 transition-colors">
                Next
            </button>
        </div>
    </div>

    <script>
        // Use a self-invoking function to keep variables out of the global scope
        (function() {
            // ====================================================================
            // Step 1: Replace this mock course data with your own course details.
            //
            // The `tee` coordinates are now used to trigger the auto-advance feature.
            //
            // Format:
            // hole: the hole number
            // par: the par for the hole (optional, but good for context)
            // tee: [latitude, longitude] of the tee box for this hole
            // front: [latitude, longitude] of the front of the green
            // center: [latitude, longitude] of the center of the green
            // back: [latitude, longitude] of the back of the green
            // ====================================================================
            const courseData = {
                name: "HadleyCreek",
                holes: [
                    { hole: 1, par: 3, tee: [44.075384, -92.431759], front: [39.7392, -104.9903], center: [39.7394, -104.9904], back: [39.7396, -104.9905] },
                    { hole: 2, par: 4, tee: [44.073303, -92.431259], front: [39.7400, -104.9910], center: [39.7402, -104.9912], back: [39.7404, -104.9914] },
                    { hole: 3, par: 3, tee: [44.073554, -92.434544], front: [39.7408, -104.9920], center: [39.7410, -104.9921], back: [39.7412, -104.9922] },
                    { hole: 4, par: 3, tee: [44.072748, -92.434836], front: [39.7420, -104.9930], center: [39.7422, -104.9931], back: [39.7424, -104.9932] },
                    { hole: 5, par: 4, tee: [44.074034, -92.439247], front: [39.7430, -104.9940], center: [39.7432, -104.9941], back: [39.7434, -104.9942] },
                    { hole: 6, par: 3, tee: [44.073704, -92.443746], front: [39.7440, -104.9950], center: [39.7442, -104.9951], back: [39.7444, -104.9952] },
                    { hole: 7, par: 4, tee: [44.075151, -92.445116], front: [39.7450, -92.43810], center: [39.7452, -104.9961], back: [39.7454, -104.9962] },
                    { hole: 8, par: 3, tee: [44.074850, -92.439902], front: [44.07491, -104.9970], center: [44.07495, -92.4380], back: [44.07499, -9243790] },
                    { hole: 9, par: 4, tee: [44.074869, -92.436735], front: [39.7470, -104.9980], center: [39.7472, -104.9981], back: [39.7474, -104.9982] }
                ]
            };

            let currentHoleIndex = 0;
            const proximityThreshold = 40; // Distance in yards to trigger next hole from the tee box.

            // ====================================================================
            // Helper functions to handle the logic
            // ====================================================================
            
            // Haversine formula to calculate distance between two lat/lon points
            function haversine(lat1, lon1, lat2, lon2) {
                const R = 6371; // Earth's radius in km
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                          Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                const distance_km = R * c;
                return distance_km * 1093.61; // Convert km to yards
            }

            // Function to update the UI with current hole and course info
            function updateUI() {
                const hole = courseData.holes[currentHoleIndex];
                document.getElementById('course-name').textContent = courseData.name;
                document.getElementById('hole-info').textContent = `Hole ${hole.hole} | Par ${hole.par}`;
            }

            // Function to calculate and display distances to the current hole
            function displayDistances(position) {
                const userLat = position.coords.latitude;
                const userLon = position.coords.longitude;
                const currentHole = courseData.holes[currentHoleIndex];
                
                const frontEl = document.getElementById('distance-front');
                const centerEl = document.getElementById('distance-center');
                const backEl = document.getElementById('distance-back');

                const distFront = haversine(userLat, userLon, currentHole.front[0], currentHole.front[1]);
                const distCenter = haversine(userLat, userLon, currentHole.center[0], currentHole.center[1]);
                const distBack = haversine(userLat, userLon, currentHole.back[0], currentHole.back[1]);

                frontEl.textContent = Math.round(distFront);
                centerEl.textContent = Math.round(distCenter);
                backEl.textContent = Math.round(distBack);
            }
            
            // Main function to watch the user's position and update the UI
            function watchGolfPosition() {
                const messageArea = document.getElementById('message-area');
                if ("geolocation" in navigator) {
                    messageArea.textContent = 'Watching your location...';

                    // Use watchPosition to get continuous location updates
                    navigator.geolocation.watchPosition(
                        (position) => {
                            const userLat = position.coords.latitude;
                            const userLon = position.coords.longitude;
                            
                            // Check if the user is near the next tee box to auto-advance
                            if (currentHoleIndex < courseData.holes.length - 1) {
                                const nextHole = courseData.holes[currentHoleIndex + 1];
                                const distToNextTee = haversine(userLat, userLon, nextHole.tee[0], nextHole.tee[1]);
                                
                                if (distToNextTee <= proximityThreshold) {
                                    currentHoleIndex++;
                                    updateUI();
                                    messageArea.textContent = `Auto-advanced to Hole ${courseData.holes[currentHoleIndex].hole}!`;
                                } else {
                                    // If not advancing, just display the current distances
                                    displayDistances(position);
                                    messageArea.textContent = 'Distances updated.';
                                }
                            } else {
                                // If on the last hole, just display distances
                                displayDistances(position);
                                messageArea.textContent = 'Distances updated.';
                            }
                        },
                        (error) => {
                            messageArea.textContent = 'Error: ' + error.message;
                            console.error("Geolocation error:", error);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );
                } else {
                    messageArea.textContent = "Geolocation is not supported by your browser.";
                }
            }

            // Event listeners for user interaction
            document.getElementById('next-hole-btn').addEventListener('click', () => {
                if (currentHoleIndex < courseData.holes.length - 1) {
                    currentHoleIndex++;
                    updateUI();
                }
            });

            document.getElementById('prev-hole-btn').addEventListener('click', () => {
                if (currentHoleIndex > 0) {
                    currentHoleIndex--;
                    updateUI();
                }
            });

            // The "Refresh" button will now manually trigger a location update and check
            document.getElementById('get-distance-btn').addEventListener('click', () => {
                // Since we are watching the position, a refresh is less critical,
                // but this button can force an immediate re-calculation.
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        displayDistances(position);
                        document.getElementById('message-area').textContent = 'Manual refresh completed.';
                    },
                    (error) => {
                        document.getElementById('message-area').textContent = 'Error: ' + error.message;
                        console.error("Geolocation error:", error);
                    }
                );
            });

            // Initial setup and start watching position
            updateUI();
            watchGolfPosition();

        })();
    </script>
</body>
</html>


